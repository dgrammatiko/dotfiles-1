#!/usr/bin/env python
"""
NAME
    library -- open URL from clipboard in Chrome via Monash account

DESCRIPTION
    The `library` utility takes a URL from the system clipboard and adds
    '.ezproxy.lib.monash.edu.au' to the domain part, then opens this
    URL in Google Chrome. This allows for gaining access to journal
    articles via the Monash library.

NOTES
    Only works on macOS, and with Google Chrome.

AUTHORS
    Daniel Mentiplay
"""

import subprocess


def add_monash_library_to_url(url: str) -> str:
    """Add '.ezproxy.lib.monash.edu.au' to domain part of URL.

    Parameters
    ----------
    url
        The URL.

    Returns
    -------
    str
        The new URL.
    """
    if not (url.startswith('http://') or url.startswith('https://')):
        raise ValueError(
            'The contents of the system clipboard are not a http nor https URL.'
        )
    try:
        new_url, rest = url.split('//', maxsplit=1)
    except ValueError:
        raise ValueError('The contents of the system clipboard could not be parsed.')
    new_url += '//'
    try:
        domain, rest = rest.split('/', maxsplit=1)
    except ValueError:
        raise ValueError('The contents of the system clipboard could not be parsed.')
    new_url += domain + '.ezproxy.lib.monash.edu.au/'
    new_url += rest
    return new_url


if __name__ == "__main__":
    result = subprocess.run(['pbpaste'], stdout=subprocess.PIPE, text=True)
    new_url = add_monash_library_to_url(result.stdout)
    subprocess.run(
        ['/Applications/Google Chrome.app/Contents/MacOS/Google Chrome', new_url]
    )
